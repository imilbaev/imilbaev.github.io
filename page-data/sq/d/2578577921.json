{"data":{"markdownRemark":{"html":"<p>I think every software developer should read this great book. It has all necessary answers to refactoring related questions. Below, I'm sharing with you what I've learned after reading the book.</p>\n<h2>When we should refactor?</h2>\n<p>The best time for refactoring is just before you need to add a new feature to the code base. If you need to add a feature to a program first of all you should prepare the code, make it easy to add a feature and only then add the feature itself. Before you start refactoring you need to have solid test coverage. Refactoring is about making small changes. Therefore tests will make sure you will find where the bug is. After small changes to the codebase - commit the changes to version control.</p>\n<p>Refactoring is always about making code \"easier to understand and cheaper to modify\". Rather than start refactoring by the plan you better should do refactoring as part of adding a feature or fixing a bug. Most of refactoring should happen while doing other things. Refactoring is not about adding future flexibility and currently unnecessary functionality(YAGNI), but about writing code that excellently solves current visible needs. The main reason for refactoring is economic benefits: refactor because it makes you faster—faster to add features, faster to fix bugs.</p>\n<ul>\n<li>Do refactoring when you are adding a new feature of fixing a bug.</li>\n<li>Do not refactor when you see a code mess but you don't need to modify it and when it’s easier to rewrite code than to refactor it.</li>\n</ul>\n<p>Good software design is about modularity — the ability to make most modifications to a program while only having to understand a small part of it.</p>\n<h2>What and how to refactor</h2>\n<h3>Mysterious names</h3>\n<p>Naming is one of the two hard things in writing code (second is cache invalidation). Naming things well is the heart of clear programming. Rename variable because variables can do a lot.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> b <span class=\"token operator\">*</span> koef\n<span class=\"token keyword\">const</span> salary <span class=\"token operator\">=</span> base <span class=\"token operator\">*</span> gradeKoefficient</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>If you choose a suitable name for a function, you mostly won’t need to look at its body. Here is the tip: a good way to choose a name is to write a comment that describes the function’s purpose, then turn that comment into a name.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token function\">getCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// no idea from where we get the cache</span>\n<span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token function\">getCacheFromLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3>Duplicated code</h3>\n<p>Duplication means that every time you read the same code in different places, you need to read them carefully to see if there’s any difference. And if you need to change the duplicated code, you have to find and catch each duplication.</p>\n<h3>Long function</h3>\n<p>The longer a function is, the more difficult it is to understand. Extract function. Look at a fragment of code, understand what it is doing, then extract it into its own function named after its purpose. Whenever you feel the need to comment something - write a function instead.</p>\n<h3>Long parameter list</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> salary <span class=\"token operator\">=</span> <span class=\"token function\">calculateSalary</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>To improve such a smelling code you can replace the parameter with a query or introduce a parameter object. Groups of data items that regularly travel together, appearing in function after function and replace it with a single data structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> salary <span class=\"token operator\">=</span> <span class=\"token function\">calculateSalary</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  base<span class=\"token operator\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n  gradeKoefficient<span class=\"token operator\">:</span> <span class=\"token number\">1.15</span><span class=\"token punctuation\">,</span>\n  bonus<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\n  loyalEmployee<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Especially remove flag argument because they make harder understanding of what will change in function behavior if you change the flag to the opposite.</p>\n<h3>Global data</h3>\n<p>The main problem with global data is that it can be changed from anywhere and it is hard to track the source of the problem.</p>\n<h3>Mutable data</h3>\n<p>Mutable data leads to unexpected behavior and tricky bugs that hard to discover. Encapsulate variable. Data is more awkward to manipulate than functions.</p>\n<h3>Feature envy</h3>\n<p>Feature envy occurs when a function in a module spends time on communication with data in another module. To solve this problem you can extract and move the function to another module.</p>\n<h3>Data clumps</h3>\n<p>Data is more awkward to manipulate than functions. Encapsulate variables. The greater the scope of the data, the more important it is to encapsulate.</p>\n<h3>Loops</h3>\n<p>Loops are anachronisms. Most modern languages provide a better alternative for them. For example, we can replace the loop with the pipeline. At least we can split loops because often loops are doing two different things at once just because they can do it:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> averageAge <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">let</span> totalSalary <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> person <span class=\"token keyword\">of</span> persons<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  averageAge <span class=\"token operator\">+=</span> person<span class=\"token punctuation\">.</span>age\n  totalSalary <span class=\"token operator\">+=</span> person<span class=\"token punctuation\">.</span>salary\n<span class=\"token punctuation\">}</span>\naverageAge <span class=\"token operator\">=</span> averageAge <span class=\"token operator\">/</span> persons<span class=\"token punctuation\">.</span>length</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> averageAge <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> person <span class=\"token keyword\">of</span> persons<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  averageAge <span class=\"token operator\">+=</span> person<span class=\"token punctuation\">.</span>age\n<span class=\"token punctuation\">}</span>\naverageAge <span class=\"token operator\">=</span> averageAge <span class=\"token operator\">/</span> persons<span class=\"token punctuation\">.</span>length\n\n<span class=\"token keyword\">let</span> totalSalary <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> person <span class=\"token keyword\">of</span> persons<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  averageAge <span class=\"token operator\">+=</span> person<span class=\"token punctuation\">.</span>age\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Many programmers are uncomfortable with this refactoring, as it forces you to execute the loop twice. But we should separate refactoring from optimization. Finish refactoring first and do performance tuning afterward.</p>\n<h3>Comments</h3>\n<p>The author does not call upon stop commenting. He only advises stopping commenting if the reason is that the code is bad. In situations when you need a comment to explain what a block of code does just extract the block into a separate function with a suitable name.</p>\n<h3>Dead code</h3>\n<p>Remove dead code. Unused code is still a significant burden when trying to understand how the software works. The version control system will do the work for you.</p>\n<h3>Large class</h3>\n<p>When code dealing with different things, look for a way to split it.</p>\n<h3>Conditionals</h3>\n<p>One of the most common sources of complexity in a program is complex conditional logic. Extract them into functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>age <span class=\"token operator\">>=</span> <span class=\"token number\">18</span> <span class=\"token operator\">&amp;&amp;</span> age <span class=\"token operator\">&lt;=</span> <span class=\"token number\">27</span> <span class=\"token operator\">&amp;&amp;</span> position <span class=\"token operator\">===</span> <span class=\"token string\">\"defender\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  score <span class=\"token operator\">=</span> baseKoef <span class=\"token operator\">*</span> defenderKoef <span class=\"token operator\">+</span> youthBonus\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  score <span class=\"token operator\">=</span> baseKoef <span class=\"token operator\">*</span> regularKoef\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">youngDefender</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  score <span class=\"token operator\">=</span> <span class=\"token function\">youngDefenderScore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  score <span class=\"token operator\">=</span> <span class=\"token function\">regularScore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Second approach is to replace conditional with polymorphism. First of all we need to combine functions into a class:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>player<span class=\"token punctuation\">.</span>role<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">case</span> <span class=\"token string\">\"Goalkeeper\"</span><span class=\"token operator\">:</span>\n<span class=\"token keyword\">return</span> <span class=\"token string\">\"low\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">case</span> <span class=\"token string\">\"Striker\"</span><span class=\"token operator\">:</span>\n<span class=\"token keyword\">return</span> <span class=\"token string\">\"high\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">case</span> <span class=\"token string\">\"Midfielder\"</span><span class=\"token operator\">:</span>\n<span class=\"token keyword\">return</span> player<span class=\"token punctuation\">.</span>age <span class=\"token operator\">></span> <span class=\"token number\">30</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"low\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"average\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n<span class=\"token keyword\">return</span> <span class=\"token string\">\"average\"</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Goalkeeper</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">get</span> <span class=\"token function\">speed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"low\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Striker</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">get</span> <span class=\"token function\">speed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"high\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Midfielder</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">get</span> <span class=\"token function\">speed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">></span> <span class=\"token number\">30</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"low\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"average\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"title":"Martin Fowler «Refactoring» book overview","date":"September 1, 2020","tags":["Book review"]}}}}